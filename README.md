# DA LEARN - Backend One

## üçÑ Mario Kart API

## üõ†Ô∏è Getting Started

### üöÄ Prerequisites
- Postman
- Docker
- Java 21 JDK
- DataGrip (optional)

--------
### üóÑÔ∏è Database Setup
#### Run from your command line to start a PostgreSQL database using Docker:
```
docker run --detach --restart unless-stopped --name da-learn --env POSTGRES_PASSWORD=docker --publish 5432:5432 --volume $HOME/docker/volumes/da-learn/postgres:/var/lib/postgresql/data postgres:16.2
```

#### Once the container is running, you can connect to it using Postgres CLI.
```shell
psql -U postgres -h localhost -d postgres
```

#### Run the following SQL commands to set up the database and user:
```sql
DROP ROLE IF EXISTS da_learn;
CREATE ROLE da_learn WITH PASSWORD 'password' LOGIN CREATEDB;
DROP DATABASE IF EXISTS backend_one;
CREATE DATABASE backend_one;
GRANT ALL ON DATABASE backend_one TO da_learn;
```

#### [OPTIONAL] DataGrip Connection:
- Navigate to the + icon in the top left corner, select ``Data Source`` > ``PostgreSQL`` and fill in the details:
  - User: `postgres`
  - Password: `docker`
- Ensure port is 5432, and press ``Test Connection`` to verify it's working.
- Once satisfied, hit ``OK`` to create the connection.

#### üö® Once finished - stop the postgres container

--------
### üì¨ Postman Collection Setup
TODO


--------
### üèóÔ∏è Build and Run the Application

#### To build the application, run the following command in your terminal:
```shell
mvn clean install
```

#### If docker is running, you can run the application using:
```shell
mvn spring-boot:run
```
- The app should start and DB should spin up in docker desktop.


### Issues
- If you encounter any issues during the setup of the application, reach out to Andrew Irvine or Ross Gartland on Slack and we'll be more than happy to help!


--------
### üß≠ Tutorial 
- Once the application is running locally and database set up, we can dive in!

### PART 1: Spring Controllers

#### 1Ô∏è‚É£ See Who's in the DB
- Let‚Äôs check if any characters are already saved. On Postman, select the ``Get All Characters`` request and hit send.
- You'll probably get an empty array '[]' back - the kingdom is empty right now!

#### 2Ô∏è‚É£ Add Default Mario Characters
- That's no fun; let's bring some familiar faces into the game. Select the ``Save Default Characters`` request and hit send.
  - If you navigate to the method in ``saveDefaultCharacters()`` in ``CharacterService`` you'll see that it creates a few staple characters.
- Now, if you rerun the request from 1Ô∏è‚É£ you should now see a list of familiar characters appear in the DB table.

#### 3Ô∏è‚É£ Add a New Character (Your Choice!)
- Feeling creative? Add your own Mario-inspired character. Select the ``Save Character`` request, populate the request body and hit send.

##### Example Request Body:
```json
{
  "name": "Waluigi",
  "species": "Human",
  "character_type": "Antagonist",
  "origin_game": "Mario Tennis",
  "created_year": 2000
}
```

#### 4Ô∏è‚É£ Get Single Character
- Let's verify your new character has been added. We could use the endpoint from 1Ô∏è‚É£ but let's try a more specific one.
- Select the ``Get Character`` request and add your new character's name into the ``character_name`` path variable.
- You should get a response with your character's details from 3Ô∏è‚É£ - notice the id field, which is automatically generated by the database; nifty!

#### 5Ô∏è‚É£ Delete a Character
- Okay; it's time to get nasty. Let's remove a character.
  - Hint: Rerun the request from 1Ô∏è‚É£ if you need a reminder of the characters in the DB.
- Select the ``Delete Character`` request, add the name of the character you want to remove in the ``character_name`` path variable and then send.

- You should get a 204 response back indicating the character was successfully deleted.
- Finally, run the request from 1Ô∏è‚É£ to check the character has indeed been deleted.

#### 6Ô∏è‚É£ Add some tracks
- Now we have our cast of characters sorted - lets get some tracks added for them to race.
- In Postman, create from scratch an HTTP POST request to hit the endpoint that runs the method ``saveDefaultTracks()`` in ``TrackService``.
- Store the request in the tracks folder in the postman collection.
  - Hint: Make sure you include all path segments and if you get stuck, reference the corresponding request for the character table.

#### 7Ô∏è‚É£ Explore the race truck CRUD endpoints
- Just like before, you'll see in Postman we now have endpoints to retrieve, save and delete tracks.
- Feel free to play around with deletes and retrievals.
  - But ensure the default 8 tracks are in the DB by the end of this step.

#### 8Ô∏è‚É£ Add 2 tracks of your own
- Everyone has a track in Mario kart that they love (or hate).
  - If you don't, do a quick google search for inspiration.
- Fill in the empty request body values in the ``Save Track`` request in Postman and hit send.
- By now we should have 10 tracks in the database... by my reckoning we have enough to simulate a grand prix.

### CHECKPOINT:
- Nice work! You've learnt lots and had plenty of hands on experience with CRUD operations in a Spring Boot application.
- Before we proceed:
  - Check you have 5 characters in the DB
  - Check you have 10 tracks in the DB
  - Check you're ready to get into some hardcore Java code.

Ready? Let's go!

### PART 2: Java Logic


TODO:
implement grandprix logic fully then remove bits // comment out so no compile issues
- takes the characters, difficulty rating and tracks 
- randomises the order of tracks and then for each track, randomises the order of characters
- the order of characters will then be weighted to give characters points for winning
- the points will then be totalled and the character with the most points at the end of the grand prix is winner
- return a summary of the grand prix with winner

json response will have 
raceOutcomes:
```json
{
  "grandPrixSummary": {
    "winner": "Mario",
    "totalPoints": 25
  },
  "raceOutcomes": [
    {
      "trackName": "Moo Moo Meadows",
      "results": 
        {
          "first": "Luigi",
          "second": "Mario",
          "third": "Daisy"
        }
    }
  ]
}
```
// just top 3 for brevity 
// grand prix summary will have winner, runner up, third place 


